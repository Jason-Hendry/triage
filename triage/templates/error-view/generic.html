{% extends "layout/fluid-sidebar.html" %}
{% block navigation %}{% endblock %}

{% block sidebar %}

	<h5>Related Errors</h5>

	<dl>
		{% for e in other_errors %}
			<dt><a href="{{route_url('error_view', project=selected_project.id, id=e._id)}}">{{e.message}}</a></dt>
			<dd data-timeago="{{ e.timestamp }}"></dd>
		{% endfor %}
	</dl>

{% endblock %}

{% block content %}

	{% block toolbar %}
		<ul id="navigation" class="toolbar cf">
			{% if error.hidden %}
				<li><a href="{{route_url('error_toggle_hide', project=selected_project.id, id=error._id)}}">Unhide Error</a></li>
			{% else %}
				<li><a href="{{route_url('error_toggle_hide', project=selected_project.id, id=error._id)}}">Hide Error</a></li>
			{% endif %}

			{% if error.claimedby %}
				{% if user['email'] == error.claimedby['email'] %}
					<li class="pull-right"><a href="{{route_url('error_toggle_claim', project=selected_project.id, id=error._id)}}">Unclaim Error</a></li>
				{% else %}
					<li class="pull-right no-link">Claimed by {{ error.claimedby['name'] }}</li>
				{% endif %}
			{% else %}
				<li class="pull-right"><a href="{{route_url('error_toggle_claim', project=selected_project.id, id=error._id)}}">Claim Error</a></li>
			{% endif %}
		</ul>
	{% endblock %}

	<div id="error">

		<hgroup>
			<h1>{{ error.type }}: {{ error.message }}</h1>
			<h2>
				{% if error.file %}
					File "{{ error.file }}",
				{% endif %}
				{% if error.line %}
					line {{ error.line }},
				{% endif %}
				{% if error.stacktrace %}
					in {{ error.stacktrace[0].function }}
				{% endif %}
			</h2>
		</hgroup>

		<dl>
			{% if error.code %}
			<dt>Code</dt>
			<dd>{{ error.code }}</dd>
			{% endif %}

			{% if error.hash %}
			<dt>Hash</dt>
			<dd>{{ error.hash }}</dd>
			{% endif %}

			{% if error.severity %}
			<dt>Severity</dt>
			<dd>{{ error.severity }}</dd>
			{% endif %}

			{% if error.language %}
			<dt>Language</dt>
			<dd>{{ error.language }}</dd>
			{% endif %}

			{% if error.level %}
			<dt>Level</dt>
			<dd>{{ error.level }}</dd>
			{% endif %}

			{% if error.timestamp %}
			<dt>Timestamp</dt>
			<dd><span data-timeago="{{ error.timestamp }}"></span></dd>
			{% endif %}

			{% if error.application %}
			<dt>Application</dt>
			<dd>{{ error.application }}</dd>
			{% endif %}

			{% if error.host %}
			<dt>Host</dt>
			<dd>{{ error.host }}</dd>
			{% endif %}

			{% if error.context %}

			{% if error.context['Server Name'] %}
			<dt>Server Name</dt>
			<dd>{{ error.context['Server Name'] }}</dd>
			{% endif %}

			{% if error.context['User IP'] %}
			<dt>User IP</dt>
			<dd>{{ error.context['User IP'] }}</dd>
			{% endif %}

			{% if error.context['Request'] %}
			<dt>Request</dt>
			<dd>{{ error.context['Request'] }}</dd>
			{% endif %}

			{% if error.context['Environment'] %}
			<dt>Environment</dt>
			<dd>{{ error.context['Environment'] }}</dd>
			{% endif %}

			{% if error.context['Referer'] %}
			<dt>Referer</dt>
			<dd>{{ error.context['Referer'] }}</dd>
			{% endif %}

			{% if error.context['User'] %}
			<dt>User</dt>
			<dd>{{ error.context['User'] }}</dd>
			{% endif %}

			{% if error.context['User Agent'] %}
			<dt>User Agent</dt>
			<dd>{{ error.context['User Agent'] }}</dd>
			{% endif %}

			{% endif %}
		</dl>

	</div>

	<h2>Stacktrace</h2>
	<table class="bordered-table zebra-striped">

		<thead>
			<tr>
				<th>Method</th>
				<th>File</th>
			</tr>
		</thead>

		<tbody>

			{% for row in error.stacktrace %}
				<tr>
					<td>
						{% if row.class %}{{ row.class }}::{% endif %}{% if row.function %}{{ row.function }}{% endif %}
					</td>
					<td>
						{% if row['file'] %}
							{{ row|github_link }}
						{% else %}
							-
						{% endif %}
					</td>
				</tr>
			{% endfor %}

		</tbody>

	</table>

	{% if form and user %}
		{{ form }}
	{% endif %}

	{% if error.comments %}
	<ul id="comments">
		{% for row in error.comments %}
			<li class="comment">
				<div class="comments-info">
					About <span data-timeago="{{ row.timecreated }}">{{ row.timecreated }}</span> {{ row.name }} said:
				</div>
				<div class="comments-comment">
					{{ row.comment }}
				</div>
				</td>
			</li>
		{% endfor %}
	</ul>
	{% endif %}

{% endblock %}
